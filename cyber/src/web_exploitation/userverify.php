<?php
 error_reporting(E_ALL);
 ini_set('display_errors', 1);

$host = 'localhost';
$dbname = 'elad_cr4';
$username = 'elad';
$password = 'admin123';
 
$connect = mysqli_connect($host, $username, $password, $dbname);
if($connect === false){
    die("ERROR: Could not connect. "
        . mysqli_connect_error());
}

//uname psw
 
// hash() if it doesnt work
 if ($_SERVER["REQUEST_METHOD"] === "POST") {
    // Get input data from the form
    $username = $_POST["uname"];
    $unhashed = $_POST["psw"];
    $hashed_passwod = hash('md5', $_POST["psw"]);

    // Prepare and execute the SQL query
    $stmt = $connect->prepare("SELECT phone_num FROM mytable WHERE username = ? AND password = ?");
    $stmt->bind_param("ss", $username, $hashed_passwod);
    $stmt->execute();
    $stmt->bind_result($phone);
    $stmt->fetch();
    $stmt->close();

    if ($phone) {
    // Authentication successful, return phone number
    $_SESSION["authenticated"] = true;
    $_SESSION["username"] = $username;

    // Set the session timeout to 30 minutes (in seconds)
    $_SESSION['start'] = time(); 
    
    // Destroying session after 1 minute
    $_SESSION['expire'] = $_SESSION['start'] + (1 * 10) ; 
    
    $_SESSION["phone"] = $phone;
    echo "youv'e logged in successfully, your phone number is:$phone"; // Redirect to welcome.php after successful login
    // it will jump back to index.html after 5 seconds
    header( "refresh:5;url=index.html" );
} else {
  // Authentication failed
echo "</br>"."user name: $username"."</br>"." password: $hashed_passwod"."$unhashed ";
   echo "</br>". "Invalid credentials";
}
}

mysqli_close($connect);

?>
 